{"version":3,"file":"gpaBuilders.mjs","sources":["../../../../src/plugins/nftModule/gpaBuilders.ts"],"sourcesContent":["import { Buffer } from 'buffer';\nimport { PublicKey } from '@solana/web3.js';\nimport { Key, PROGRAM_ID } from '@metaplex-foundation/mpl-token-metadata';\nimport { Metaplex } from '@/Metaplex';\nimport { GpaBuilder, padEmptyChars } from '@/utils';\nimport { toBigNumber } from '@/types';\n\nconst MAX_NAME_LENGTH = 32;\nconst MAX_SYMBOL_LENGTH = 10;\nconst MAX_URI_LENGTH = 200;\nconst MAX_CREATOR_LEN = 32 + 1 + 1;\nconst DATA_START = 1 + 32 + 32;\nconst NAME_START = DATA_START + 4;\nconst SYMBOL_START = NAME_START + MAX_NAME_LENGTH + 4;\nconst URI_START = SYMBOL_START + MAX_SYMBOL_LENGTH + 4;\nconst CREATORS_START = URI_START + MAX_URI_LENGTH + 2 + 1 + 4;\n\nexport class TokenMetadataGpaBuilder extends GpaBuilder {\n  constructor(metaplex: Metaplex, programId?: PublicKey) {\n    super(metaplex, programId ?? PROGRAM_ID);\n  }\n\n  whereKey(key: Key) {\n    return this.where(0, toBigNumber(key, 'le'));\n  }\n}\n\nexport class MetadataV1GpaBuilder extends TokenMetadataGpaBuilder {\n  constructor(metaplex: Metaplex, programId?: PublicKey) {\n    super(metaplex, programId);\n    this.whereKey(Key.MetadataV1);\n  }\n\n  selectUpdatedAuthority() {\n    return this.slice(1, 32);\n  }\n\n  whereUpdateAuthority(updateAuthority: PublicKey) {\n    return this.where(1, updateAuthority);\n  }\n\n  selectMint() {\n    return this.slice(33, 32);\n  }\n\n  whereMint(mint: PublicKey) {\n    return this.where(33, mint);\n  }\n\n  selectName() {\n    return this.slice(NAME_START, MAX_NAME_LENGTH);\n  }\n\n  whereName(name: string) {\n    return this.where(\n      NAME_START,\n      Buffer.from(padEmptyChars(name, MAX_NAME_LENGTH))\n    );\n  }\n\n  selectSymbol() {\n    return this.slice(SYMBOL_START, MAX_SYMBOL_LENGTH);\n  }\n\n  whereSymbol(symbol: string) {\n    return this.where(\n      SYMBOL_START,\n      Buffer.from(padEmptyChars(symbol, MAX_SYMBOL_LENGTH))\n    );\n  }\n\n  selectUri() {\n    return this.slice(URI_START, MAX_URI_LENGTH);\n  }\n\n  whereUri(uri: string) {\n    return this.where(\n      URI_START,\n      Buffer.from(padEmptyChars(uri, MAX_URI_LENGTH))\n    );\n  }\n\n  selectCreator(position: number) {\n    return this.slice(\n      CREATORS_START + (position - 1) * MAX_CREATOR_LEN,\n      CREATORS_START + position * MAX_CREATOR_LEN\n    );\n  }\n\n  whereCreator(position: number, creator: PublicKey) {\n    return this.where(\n      CREATORS_START + (position - 1) * MAX_CREATOR_LEN,\n      creator\n    );\n  }\n\n  selectFirstCreator() {\n    return this.selectCreator(1);\n  }\n\n  whereFirstCreator(firstCreator: PublicKey) {\n    return this.whereCreator(1, firstCreator);\n  }\n}\n"],"names":["MAX_NAME_LENGTH","MAX_SYMBOL_LENGTH","MAX_URI_LENGTH","MAX_CREATOR_LEN","DATA_START","NAME_START","SYMBOL_START","URI_START","CREATORS_START","TokenMetadataGpaBuilder","GpaBuilder","constructor","metaplex","programId","PROGRAM_ID","whereKey","key","where","toBigNumber","MetadataV1GpaBuilder","Key","MetadataV1","selectUpdatedAuthority","slice","whereUpdateAuthority","updateAuthority","selectMint","whereMint","mint","selectName","whereName","name","Buffer","from","padEmptyChars","selectSymbol","whereSymbol","symbol","selectUri","whereUri","uri","selectCreator","position","whereCreator","creator","selectFirstCreator","whereFirstCreator","firstCreator"],"mappings":"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"}